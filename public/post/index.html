<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.18.1" />
	
	<title>Posts - helpful programming nuggets.</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="http://databae.io/css/bootstrap.min.css" rel="stylesheet">
	<link href="http://databae.io/css/strange-case.css" rel="stylesheet">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body class="scheme-slate">


	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
	<div class="sidebar-content">

		<a href="http://databae.io"><h1>databae.io</h1></a>
		<p>helpful programming nuggets.</p>

		

		<ul class="sidebar-menus">
			
		</ul>

		<div class="sidebar-recent hidden-xs">
			<p>posts</p>
			<ul>
                
				<li><a href="http://databae.io/post/dumb-birthdays/">dumb birthdays</a></li>
				
				<li><a href="http://databae.io/post/gspread/">gspread</a></li>
				
				<li><a href="http://databae.io/post/information-schema/">information schema</a></li>
				
				<li><a href="http://databae.io/post/n-choose-k/">n choose k</a></li>
				
				<li><a href="http://databae.io/post/postgres-admin-queries/">postgres admin queries</a></li>
				
				<li><a href="http://databae.io/post/postgres-json-queries/">postgres json queries</a></li>
				
				<li><a href="http://databae.io/post/psql/">psql</a></li>
				
				<li><a href="http://databae.io/post/sed/">sed</a></li>
				
				<li><a href="http://databae.io/post/sql-basics/">sql basics</a></li>
				
				<li><a href="http://databae.io/post/sql-to-csv/">sql to csv</a></li>
				
				<li><a href="http://databae.io/post/sqlalchemy-stored-procs/">sqlalchemy and stored procs</a></li>
				
				<li><a href="http://databae.io/post/ssh-keygen/">ssh keygen</a></li>
				
				<li><a href="http://databae.io/post/todo-cli/">todo cli</a></li>
				
				<li><a href="http://databae.io/post/web-cli/">web cli</a></li>
				
			</ul>
		</div>

        <div style="text-align:right">
            <span><a target="_blank" href="https://github.com/ryantuck/databae.io"><i class="fa fa-github fa-2x"></i></a></span>
        </div>
	</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/n-choose-k/">n choose k</a></h1>
						<span>25 Feb 2017</span>
					</div>

					<p>Stumbled upon this and thought it was cool. There&rsquo;s probably
just some math from high school that i&rsquo;m forgetting about
that explains this in very simple terms.</p>

<p>If I have a set of <code>N</code> values:</p>

<pre><code>[0,1,2,3]
</code></pre>

<p>I can figure out the number of possible ways to choose <code>k</code>
values from them using &lsquo;n-choose-k&rsquo;:</p>

<pre><code>n_choose_k = N! / ( k! (N-k)! )
</code></pre>

<p>This gives rise to pascal&rsquo;s triangle:</p>

<pre><code class="language-python">from scipy.special import comb
ns = range(10)
combos = [list(int(comb(n,i)) for i in range(n+1)) for n in ns]
</code></pre>

<p>combos:</p>

<pre><code>[[1],
 [1, 1],
 [1, 2, 1],
 [1, 3, 3, 1],
 [1, 4, 6, 4, 1],
 [1, 5, 10, 10, 5, 1],
 [1, 6, 15, 20, 15, 6, 1],
 [1, 7, 21, 35, 35, 21, 7, 1],
 [1, 8, 28, 56, 70, 56, 28, 8, 1],
 [1, 9, 36, 84, 126, 126, 84, 36, 9, 1]]
</code></pre>

<p>For another problem, I thought I needed to sum up all of
these possible combinations for a given <code>N</code>:</p>

<pre><code class="language-python">from scipy.special import comb
ns = range(10)
combos = [sum(comb(n,i) for i in range(n+1)) for n in ns]
</code></pre>

<p>And holy crow, that&rsquo;s just <code>2^N</code>:</p>

<pre><code>[1, 2, 4, 8, 16, 32, 64, 128, 256, 512]
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/web-cli/">web cli</a></h1>
						<span>17 Feb 2017</span>
					</div>

					<p>Because switching to chrome and creating a new tab is just
too much.</p>

<pre><code class="language-bash">#!/bin/bash
open https://$1.com
</code></pre>

<p>usage:</p>

<pre><code>web google
web github
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/sqlalchemy-stored-procs/">sqlalchemy and stored procs</a></h1>
						<span>15 Feb 2017</span>
					</div>

					

<p>Ran into a weird issue having to do with calling a stored
procedure in postgres from python.</p>

<p><strong>tldr</strong> - you have to explicitly <code>begin</code> and <code>commit</code>
transactions that call stored procs because <code>select</code>
statements don&rsquo;t normally explicitly get <code>commit</code>ted. We
avoid this issue in <code>psql</code> because i guess those <code>select</code>
statements actually do end up getting committed.</p>

<h2 id="example">example</h2>

<p>Here&rsquo;s a silly stored proc:</p>

<pre><code class="language-sql">create function do_stuff()
returns void as $$
begin

truncate table my_table;

insert into my_table values
    (1,2),
    (3,4)
;

end;
$$ language plpgsql;
</code></pre>

<p>To test if it works:</p>

<ol>
<li><code>truncate table my_table;</code></li>
<li>run python script.</li>
<li><code>select * from my_table;</code> and check whether the rows were
inserted.</li>
</ol>

<h3 id="won-t-work">won&rsquo;t work</h3>

<pre><code class="language-python">import dataset

db = dataset.connect()
db.query('select do_stuff();')
</code></pre>

<p>results:</p>

<pre><code class="language-sql">select * from my_table; -- 0 rows
</code></pre>

<h3 id="will-work">will work</h3>

<pre><code class="language-python">import dataset

db = dataset.connect()
db.begin()
db.query('select do_stuff();')
db.commit()
</code></pre>

<p>or, <code>dataset</code> lets you wrap all that up as a transaction:</p>

<pre><code class="language-python">import dataset

db = dataset.connect()
with db as tx:
    tx.query('select do_stuff();')
</code></pre>

<p>results:</p>

<pre><code class="language-sql">select * from my_table; -- 2 rows (as expected)
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/gspread/">gspread</a></h1>
						<span>14 Feb 2017</span>
					</div>

					

<p>So you wanna pull some google sheets data into python?</p>

<p><code>gspread</code> is a really handy python module for doing just
that. There&rsquo;s some authentication setup involved but it&rsquo;s
pretty straightforward.</p>

<p>Once you&rsquo;ve authenticated, you can check out the <code>readme</code>
for basic usage for reading/writing to and from sheets over
at <a href="https://github.com/burnash/gspread">https://github.com/burnash/gspread</a></p>

<h2 id="setup">setup</h2>

<h3 id="creds">creds</h3>

<p>You need to set up your credentials so you can access your
google sheet. Fortunately this is pretty straightforward.</p>

<p>And the <code>gspread</code> documentation also has these instructions
<a href="http://gspread.readthedocs.io/en/latest/oauth2.html">documented
here</a>.</p>

<p>I followed the instructions
<a href="https://developers.google.com/identity/protocols/application-default-credentials?authuser=1">here</a>
but the <strong>tl;dr</strong> is that you need to head over to the <a href="https://console.developers.google.com/projectselector/apis/credentials">API
Console
Credentials</a>
section of the google developers portal.</p>

<ol>
<li>Select &lsquo;create a project&rsquo;. Give it a name. Yatta yatta
yatta.</li>
<li>Select &lsquo;create credentials&rsquo; &gt; &lsquo;Service Account Key&rsquo;. I
think this is the easiest. It&rsquo;ll basically give you a
file to download.</li>
<li>Select &lsquo;new service account&rsquo; and give it the &lsquo;Owner&rsquo;
role, along with some name.</li>
<li>Select <code>json</code> key type.</li>
<li>Hit &lsquo;create&rsquo;. This should download a <code>.json</code> file to your
computer.</li>
<li>Move that credentials file somewhere (let&rsquo;s say
<code>~/Desktop</code>).</li>
</ol>

<h3 id="share-a-sheet">share a sheet</h3>

<p>You&rsquo;ll need to share your sheet with the service account you
just created. From the credentials page, you should see a
link for &lsquo;Manage Service Accounts&rsquo;. Check that out and you
should see your service account ID for the one you just
created. It&rsquo;ll look something like</p>

<pre><code>rt-testing@123456.iam.gserviceaccount.com
</code></pre>

<p>Share your sheet with that account. Boom.</p>

<h2 id="code">code</h2>

<h3 id="install-stuff">install stuff</h3>

<pre><code>pip install gspread oauth2client PyOpenSSL
</code></pre>

<h3 id="pull-sheet">pull sheet</h3>

<p>Now pull it! <code>gspread</code> has great documentation for using the
module but I&rsquo;ve found setup to be a big pain in the ass, so
I hope this post helps.</p>

<pre><code class="language-python">import gspread
from oauth2client.service_account import ServiceAccountCredentials

# that filename path is the creds file you downloaded
credentials = ServiceAccountCredentials.from_json_keyfile_name(
    filename='/Users/ryan/Desktop/rt-testing-12345678.json',
    scopes='https://spreadsheets.google.com/feeds',
)

gc = gspread.authorize(credentials)

worksheet = gc.open('My Workbook Title').worksheet('some sheet title')

records = worksheet.get_all_records()
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/sql-basics/">sql basics</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<h2 id="select">select</h2>

<p><code>select</code> fields <code>from</code> a table.</p>

<p>select all fields:</p>

<pre><code class="language-sql">select
    *
from
    customers
</code></pre>

<p>select specific fields:</p>

<pre><code class="language-sql">select
    name,
    species
from
    pets
</code></pre>

<h2 id="where">where</h2>

<p>the <code>where</code> clause is used for filtering data.</p>

<p>get all gerbils:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
</code></pre>

<p>get all gerbils that are older than 5:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
    and
    age &gt; 5
</code></pre>

<p>get all pets that are either a gerbil or a dog:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
    or
    species = 'dog'
</code></pre>

<h2 id="sum-count-and-group-by">sum(), count(), and group by</h2>

<p>aggregate data using an aggregate function like <code>sum()</code> or <code>count()</code> in combination with the <code>group by</code> clause.</p>

<p>count number of each species:</p>

<pre><code class="language-sql">select
    species,
    count(*)
from
    pets
group by
    species
</code></pre>

<p>get total quantity sold of each <code>item_id</code> from all transactions:</p>

<pre><code class="language-sql">select
    item_id,
    sum(quantity)
from
    transaction_items
group by
    item_id
</code></pre>

<h2 id="order-by">order by</h2>

<p>sort your results.</p>

<p>sort customer names:</p>

<pre><code class="language-sql">select
    first,
    last
from
    customers
order by
    last
</code></pre>

<p>sort items by price:</p>

<pre><code class="language-sql">select
    name,
    price
from
    items
order by
    price desc
</code></pre>

<h2 id="limit">limit</h2>

<p><code>limit</code> the amount of results you return.</p>

<pre><code class="language-sql">select
    *
from
    customers
limit
    5
</code></pre>

<h2 id="as">as</h2>

<p>alias your field names <code>as</code> a more descriptive name.</p>

<pre><code class="language-sql">select
    first as first_name,
    last as last_name
from
    customers
</code></pre>

<h2 id="joins">joins</h2>

<p>the meat of SQL. <code>join</code> data from one table to another <code>on</code> a certain condition. specifically, we&rsquo;ll use <code>inner join</code>s for now. you can <code>join</code> multiple tables together by repeating the clause.</p>

<p>note the need to preface field names with the table they belong to.</p>

<pre><code class="language-sql">select
    customers.first,
    customers.last,
    pets.species,
    pets.name
from
    customers
inner join
    pets
    on
    customers.id = pets.owner_id
</code></pre>

<h2 id="putting-it-all-together">putting it all together!</h2>

<p>here&rsquo;s a mega query that uses all of the above concepts.</p>

<p><strong>give a summary of the first 8 transactions Queen Bey made at the pet store since 2010</strong></p>

<pre><code class="language-sql">select
	transactions.date as transaction_date,
	sum(items.price) as total_cost,
	count(*) as number_of_items
from 
	transactions
inner join
	customers
	on
	customers.id = transactions.customer_id
inner join
	transaction_items
	on
	transactions.id = transaction_items.transaction_id
inner join
	items
	on
	items.id = transaction_items.item_id
where
	transactions.date &gt;= '2010-01-01'
	and
	customers.first = 'beyonce'
group by
	transactions.date
order by
	transactions.date
limit
	8
</code></pre>

<h2 id="additional-resources">additional resources</h2>

<p><a href="http://www.w3schools.com/sql/sql_select.asp">w3schools</a></p>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/information-schema/">information schema</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Query the <code>information_schema</code> to find tables and columns
you&rsquo;re looking for.</p>

<script src="https://gist.github.com/ryantuck/bce48a40e663df83bfe832904db3ed91.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/postgres-json-queries/">postgres json queries</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>You can shove <code>json</code> into postgres. This is great until you
have to report on it :)</p>

<script src="https://gist.github.com/ryantuck/de263704472b80d6ec801efef9a2880e.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/postgres-admin-queries/">postgres admin queries</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Some helpful postgres admin queries.</p>

<script src="https://gist.github.com/ryantuck/46de1eec35708201d88e6beee008839a.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/sql-to-csv/">sql to csv</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Had a hell of a time trying to get the results of a <code>.sql</code>
file to output to a csv. Here&rsquo;s what I had to do:</p>

<pre><code>#!/bin/bash

# executes a .sql file and outputs results to a .csv
# ./sql_to_csv.sh my_query.sql output.csv

CONN=&quot;psql -U my_user -d my_db&quot;

# remove all semicolons and comments
# replace newlines with spaces
QUERY=&quot;$(sed 's/;//g;/^--/ d;s/--.*//g;' $1 | tr '\n' ' ')&quot;
echo &quot;$QUERY&quot;

echo &quot;\\copy ($QUERY) to '$2' with csv header&quot; | $CONN &gt; /dev/null
</code></pre>

<p>So to make it work:</p>

<pre><code>./sql_to_csv.sh my_query.sql output.csv
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/dumb-birthdays/">dumb birthdays</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<p>Made a thing for calculating dumb birthdays.</p>

<p>Call it like so:</p>

<p><a href="https://api.databae.io/birthdays/1989-04-11T10:20:00">https://api.databae.io/birthdays/1989-04-11T10:20:00</a></p>

<h2 id="code">code</h2>

<script src="https://gist.github.com/ryantuck/5125fbe4d5e8414ce6cd0e12fe96db1b.js"></script>


				</div>
				

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="http://databae.io/js/bootstrap.min.js"></script>

</body>
</html>