<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.18.1" />
	
	<title>Posts - helpful programming nuggets.</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link href="http://databae.io/css/bootstrap.min.css" rel="stylesheet">
	<link href="http://databae.io/css/strange-case.css" rel="stylesheet">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body class="scheme-slate">


	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
	<div class="sidebar-content">

		<a href="http://databae.io"><h1>databae.io</h1></a>
		<p>helpful programming nuggets.</p>

		

		<ul class="sidebar-menus">
			
		</ul>

		<div class="sidebar-recent hidden-xs">
			<p>posts</p>
			<ul>
                
				<li><a href="http://databae.io/post/dumb-birthdays/">dumb birthdays</a></li>
				
				<li><a href="http://databae.io/post/gspread/">gspread</a></li>
				
				<li><a href="http://databae.io/post/information-schema/">information schema</a></li>
				
				<li><a href="http://databae.io/post/postgres-admin-queries/">postgres admin queries</a></li>
				
				<li><a href="http://databae.io/post/postgres-json-queries/">postgres json queries</a></li>
				
				<li><a href="http://databae.io/post/psql/">psql</a></li>
				
				<li><a href="http://databae.io/post/sed/">sed</a></li>
				
				<li><a href="http://databae.io/post/sql-basics/">sql basics</a></li>
				
				<li><a href="http://databae.io/post/sql-to-csv/">sql to csv</a></li>
				
				<li><a href="http://databae.io/post/ssh-keygen/">ssh keygen</a></li>
				
				<li><a href="http://databae.io/post/todo-cli/">todo cli</a></li>
				
			</ul>
		</div>

        <div style="text-align:right">
            <span><a target="_blank" href="https://github.com/ryantuck/databae.io"><i class="fa fa-github fa-2x"></i></a></span>
        </div>
	</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/gspread/">gspread</a></h1>
						<span>14 Feb 2017</span>
					</div>

					

<p>So you wanna pull some google sheets data into python?</p>

<p><code>gspread</code> is a really handy python module for doing just
that. There&rsquo;s some authentication setup involved but it&rsquo;s
pretty straightforward.</p>

<p>Once you&rsquo;ve authenticated, you can check out the <code>readme</code>
for basic usage for reading/writing to and from sheets over
at <a href="https://github.com/burnash/gspread">https://github.com/burnash/gspread</a></p>

<h2 id="setup">setup</h2>

<h3 id="creds">creds</h3>

<p>You need to set up your credentials so you can access your
google sheet. Fortunately this is pretty straightforward.</p>

<p>And the <code>gspread</code> documentation also has these instructions
<a href="http://gspread.readthedocs.io/en/latest/oauth2.html">documented
here</a>.</p>

<p>I followed the instructions
<a href="https://developers.google.com/identity/protocols/application-default-credentials?authuser=1">here</a>
but the <strong>tl;dr</strong> is that you need to head over to the <a href="https://console.developers.google.com/projectselector/apis/credentials">API
Console
Credentials</a>
section of the google developers portal.</p>

<ol>
<li>Select &lsquo;create a project&rsquo;. Give it a name. Yatta yatta
yatta.</li>
<li>Select &lsquo;create credentials&rsquo; &gt; &lsquo;Service Account Key&rsquo;. I
think this is the easiest. It&rsquo;ll basically give you a
file to download.</li>
<li>Select &lsquo;new service account&rsquo; and give it the &lsquo;Owner&rsquo;
role, along with some name.</li>
<li>Select <code>json</code> key type.</li>
<li>Hit &lsquo;create&rsquo;. This should download a <code>.json</code> file to your
computer.</li>
<li>Move that credentials file somewhere (let&rsquo;s say
<code>~/Desktop</code>).</li>
</ol>

<h3 id="share-a-sheet">share a sheet</h3>

<p>You&rsquo;ll need to share your sheet with the service account you
just created. From the credentials page, you should see a
link for &lsquo;Manage Service Accounts&rsquo;. Check that out and you
should see your service account ID for the one you just
created. It&rsquo;ll look something like</p>

<pre><code>rt-testing@123456.iam.gserviceaccount.com
</code></pre>

<p>Share your sheet with that account. Boom.</p>

<h2 id="code">code</h2>

<h3 id="install-stuff">install stuff</h3>

<pre><code>pip install gspread oauth2client PyOpenSSL
</code></pre>

<h3 id="pull-sheet">pull sheet</h3>

<p>Now pull it! <code>gspread</code> has great documentation for using the
module but I&rsquo;ve found setup to be a big pain in the ass, so
I hope this post helps.</p>

<pre><code class="language-python">import gspread
from oauth2client.service_account import ServiceAccountCredentials

# that filename path is the creds file you downloaded
credentials = ServiceAccountCredentials.from_json_keyfile_name(
    filename='/Users/ryan/Desktop/rt-testing-12345678.json',
    scopes='https://spreadsheets.google.com/feeds',
)

gc = gspread.authorize(credentials)

worksheet = gc.open('My Workbook Title').worksheet('some sheet title')

records = worksheet.get_all_records()
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/sql-basics/">sql basics</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<h2 id="select">select</h2>

<p><code>select</code> fields <code>from</code> a table.</p>

<p>select all fields:</p>

<pre><code class="language-sql">select
    *
from
    customers
</code></pre>

<p>select specific fields:</p>

<pre><code class="language-sql">select
    name,
    species
from
    pets
</code></pre>

<h2 id="where">where</h2>

<p>the <code>where</code> clause is used for filtering data.</p>

<p>get all gerbils:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
</code></pre>

<p>get all gerbils that are older than 5:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
    and
    age &gt; 5
</code></pre>

<p>get all pets that are either a gerbil or a dog:</p>

<pre><code class="language-sql">select
    *
from
    pets
where
    species = 'gerbil'
    or
    species = 'dog'
</code></pre>

<h2 id="sum-count-and-group-by">sum(), count(), and group by</h2>

<p>aggregate data using an aggregate function like <code>sum()</code> or <code>count()</code> in combination with the <code>group by</code> clause.</p>

<p>count number of each species:</p>

<pre><code class="language-sql">select
    species,
    count(*)
from
    pets
group by
    species
</code></pre>

<p>get total quantity sold of each <code>item_id</code> from all transactions:</p>

<pre><code class="language-sql">select
    item_id,
    sum(quantity)
from
    transaction_items
group by
    item_id
</code></pre>

<h2 id="order-by">order by</h2>

<p>sort your results.</p>

<p>sort customer names:</p>

<pre><code class="language-sql">select
    first,
    last
from
    customers
order by
    last
</code></pre>

<p>sort items by price:</p>

<pre><code class="language-sql">select
    name,
    price
from
    items
order by
    price desc
</code></pre>

<h2 id="limit">limit</h2>

<p><code>limit</code> the amount of results you return.</p>

<pre><code class="language-sql">select
    *
from
    customers
limit
    5
</code></pre>

<h2 id="as">as</h2>

<p>alias your field names <code>as</code> a more descriptive name.</p>

<pre><code class="language-sql">select
    first as first_name,
    last as last_name
from
    customers
</code></pre>

<h2 id="joins">joins</h2>

<p>the meat of SQL. <code>join</code> data from one table to another <code>on</code> a certain condition. specifically, we&rsquo;ll use <code>inner join</code>s for now. you can <code>join</code> multiple tables together by repeating the clause.</p>

<p>note the need to preface field names with the table they belong to.</p>

<pre><code class="language-sql">select
    customers.first,
    customers.last,
    pets.species,
    pets.name
from
    customers
inner join
    pets
    on
    customers.id = pets.owner_id
</code></pre>

<h2 id="putting-it-all-together">putting it all together!</h2>

<p>here&rsquo;s a mega query that uses all of the above concepts.</p>

<p><strong>give a summary of the first 8 transactions Queen Bey made at the pet store since 2010</strong></p>

<pre><code class="language-sql">select
	transactions.date as transaction_date,
	sum(items.price) as total_cost,
	count(*) as number_of_items
from 
	transactions
inner join
	customers
	on
	customers.id = transactions.customer_id
inner join
	transaction_items
	on
	transactions.id = transaction_items.transaction_id
inner join
	items
	on
	items.id = transaction_items.item_id
where
	transactions.date &gt;= '2010-01-01'
	and
	customers.first = 'beyonce'
group by
	transactions.date
order by
	transactions.date
limit
	8
</code></pre>

<h2 id="additional-resources">additional resources</h2>

<p><a href="http://www.w3schools.com/sql/sql_select.asp">w3schools</a></p>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/information-schema/">information schema</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Query the <code>information_schema</code> to find tables and columns
you&rsquo;re looking for.</p>

<script src="https://gist.github.com/ryantuck/bce48a40e663df83bfe832904db3ed91.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/postgres-json-queries/">postgres json queries</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>You can shove <code>json</code> into postgres. This is great until you
have to report on it :)</p>

<script src="https://gist.github.com/ryantuck/de263704472b80d6ec801efef9a2880e.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/postgres-admin-queries/">postgres admin queries</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Some helpful postgres admin queries.</p>

<script src="https://gist.github.com/ryantuck/46de1eec35708201d88e6beee008839a.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/sql-to-csv/">sql to csv</a></h1>
						<span>12 Feb 2017</span>
					</div>

					<p>Had a hell of a time trying to get the results of a <code>.sql</code>
file to output to a csv. Here&rsquo;s what I had to do:</p>

<pre><code>#!/bin/bash

# executes a .sql file and outputs results to a .csv
# ./sql_to_csv.sh my_query.sql output.csv

CONN=&quot;psql -U my_user -d my_db&quot;

# remove all semicolons and comments
# replace newlines with spaces
QUERY=&quot;$(sed 's/;//g;/^--/ d;s/--.*//g;' $1 | tr '\n' ' ')&quot;
echo &quot;$QUERY&quot;

echo &quot;\\copy ($QUERY) to '$2' with csv header&quot; | $CONN &gt; /dev/null
</code></pre>

<p>So to make it work:</p>

<pre><code>./sql_to_csv.sh my_query.sql output.csv
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/dumb-birthdays/">dumb birthdays</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<p>Made a thing for calculating dumb birthdays.</p>

<p>Call it like so:</p>

<p><a href="https://api.databae.io/birthdays/1989-04-11T10:20:00">https://api.databae.io/birthdays/1989-04-11T10:20:00</a></p>

<h2 id="code">code</h2>

<script src="https://gist.github.com/ryantuck/5125fbe4d5e8414ce6cd0e12fe96db1b.js"></script>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/ssh-keygen/">ssh keygen</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<h2 id="create-an-ssh-key-pair">create an ssh key pair</h2>

<p>Here&rsquo;s how to create a key pair on a machine.</p>

<pre><code>ssh-keygen -t rsa -b 4096 -C &quot;ryan@tuck.com&quot;
</code></pre>

<p>To authorize that key as one you want to allow onto the
machine:</p>

<pre><code>cat ~/.ssh/new_key.pub &gt;&gt; ~/.ssh/authorized_keys
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/psql/">psql</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<p><code>psql</code> is a tool used for accessing postgres databases via
the command line.</p>

<h2 id="install">install</h2>

<pre><code>brew install postgresql
</code></pre>

<h2 id="load-csv-into-sql-really-fast">load csv into sql really fast</h2>

<p><code>psql</code> can load csv data into an existing table insanely
fast. It requires that you have an existing table and a csv
file that has the appropriate number of columns.</p>

<p>Assuming <code>test.csv</code> is on your desktop and looks like this:</p>

<pre><code>a,b,c
1,2,3
4,5,6
</code></pre>

<p>And you&rsquo;ve created a table in your database like so:</p>

<pre><code class="language-sql">create table test (
    a integer,
    b integer,
    c integer
);
</code></pre>

<p>Then load that bad boy in using <code>\copy</code>:</p>

<pre><code>$ psql
&gt; \copy test from /Users/ryan/test.csv csv header
</code></pre>


				</div>
				
				<div class="post">

					<div class="post-heading">
						<h1><a href="http://databae.io/post/todo-cli/">todo cli</a></h1>
						<span>12 Feb 2017</span>
					</div>

					

<p>I wanted to manage my todos via the command line and didn&rsquo;t
know of any obvious solution. I really didn&rsquo;t want to use
anything that was too complicated or overkill. I basically
just wanted to manage todos as easily as I would if I were
just editing markdown files. So I made something painfully
simple and it works really well for me.</p>

<h2 id="markdown-files">markdown files</h2>

<p>I started with a directory of markdown files.</p>

<pre><code>mkdir ~/todo
vim ~/todo/work.md
vim ~/todo/done.md
</code></pre>

<h2 id="shell-script">shell script</h2>

<p>Cool, now I can just edit those guys. Great. But I didn&rsquo;t
want to have to type <code>vim ~/todo/blah.md</code> every time I
wanted to edit a file. So I made a script.</p>

<p>I created <code>/usr/local/bin/todo</code>:</p>

<pre><code>#!/bin/bash

echo editing: $1
vim ~/todo/$1.md
</code></pre>

<p>Then made it executable:</p>

<pre><code>chmod +x /usr/local/bin/todo
</code></pre>

<p>And now I can simply:</p>

<pre><code>todo work
</code></pre>

<p>It&rsquo;s nice because if the file already exists I&rsquo;ll edit it
and if not it will automatically create a new one. Simple
functionality.</p>

<h2 id="autocomplete">autocomplete</h2>

<p>Once I started getting tons of files in my <code>~/todo</code>
directory, I wanted to enable autocomplete, especially so I
wouldn&rsquo;t have to type out long names. Turns out this is p
easy.</p>

<p>In my <code>~/.bash_profile</code>:</p>

<pre><code class="language-bash"># simple todo autocomplete
_todo_autocomplete()
{
    local cur opts
    COMPREPLY=()
    cur=&quot;${COMP_WORDS[COMP_CWORD]}&quot;
    opts=&quot;$(ls ~/todo | sed -e 's/\.md//g')&quot;
    COMPREPLY=( $(compgen -W &quot;${opts}&quot; -- ${cur}) )
    return 0
}

complete -F _todo_autocomplete todo
</code></pre>

<p>Now I can type <code>todo [TAB]</code> and see all options.</p>

<p>Basically, autocomplete seems like it&rsquo;s a bunch of garbage
boilerplate with the only really important part being what
you set for the <code>opts</code> variable. In my case, I wanted to
remove the <code>.md</code> extension from anything in my list because
that&rsquo;s just how I want to interact with these files:</p>

<pre><code>opts=&quot;$(ls ~/todo | sed -e 's/\.md//g')&quot;
</code></pre>

<h2 id="git">git</h2>

<p>I wanted to share my active <code>work.md</code> and <code>done.md</code> files
with my PM at work so he knows what I&rsquo;m working on at any
given time. So I made a github gist that I can then commit
the files to, and they&rsquo;re formatted all pretty because it&rsquo;s
markdown.</p>

<p>So I made a <code>~/todo/todo-gist</code> directory and added the
following script (<code>push.sh</code>):</p>

<pre><code class="language-bash">#!/bin/bash

cp ~/todo/work.md ~/todo/todo-gist/work.md
cp ~/todo/done.md ~/todo/todo-gist/done.md

d=$(date)
echo $d

cd ~/todo/todo-gist
git add .
git commit -m &quot;$d&quot;
git push origin master
</code></pre>

<p>And to make my life even easier just added an alias to my
bash profile to fire this guy off:</p>

<pre><code># push todo to gist
alias push=&quot;~/todo/todo-gist/push.sh&quot;
</code></pre>

<h2 id="conclusion">conclusion</h2>

<p>Now my workflow for managing todos looks like this:</p>

<pre><code>todo work
todo done
push
</code></pre>

<p>It&rsquo;s extremely extensible and painfully simple. No external
dependencies - just editing text files. üôè</p>


				</div>
				

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="http://databae.io/js/bootstrap.min.js"></script>

</body>
</html>